---
# Common role - 기본 시스템 설정

- name: Set timezone
  community.general.timezone:
    name: "{{ timezone }}"
  tags: [common, timezone]


- name: Update apt cache
  ansible.builtin.apt:
    update_cache: yes
    cache_valid_time: 3600
  when: ansible_facts['os_family'] == "Debian"
  tags: [common, packages]

- name: Install common packages
  ansible.builtin.apt:
    name: "{{ common_packages }}"
    state: present
  when: ansible_facts['os_family'] == "Debian"
  tags: [common, packages]

- name: Install Python packages
  ansible.builtin.pip:
    name: "{{ python_packages }}"
    state: present
  tags: [common, python]

- name: Create base directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
  loop:
    - "{{ base_dir }}"
  tags: [common, directories]

- name: Configure UFW firewall
  community.general.ufw:
    rule: allow
    port: "{{ item }}"
    proto: tcp
  loop: "{{ firewall_allowed_tcp_ports }}"
  when: firewall_enabled | default(false)
  tags: [common, firewall]

- name: Enable UFW
  community.general.ufw:
    state: enabled
  when: firewall_enabled | default(false)
  tags: [common, firewall]
