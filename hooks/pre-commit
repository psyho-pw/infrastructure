#!/bin/bash
# Pre-commit hook: Ansible lint ì‹¤í–‰
#
# ì„¤ì¹˜ ë°©ë²•:
#   make install-hooks
# ë˜ëŠ”
#   ln -sf ../../hooks/pre-commit .git/hooks/pre-commit

set -e

echo "ðŸ” Running ansible-lint..."

# ansible-lint ì‹¤í–‰
if ! ANSIBLE_VAULT_PASSWORD_FILE=.vault_pass ansible-lint --fix; then
    echo "âŒ ansible-lint failed. Please fix the issues before committing."
    exit 1
fi

echo "âœ… ansible-lint passed!"

# ë³€ê²½ëœ íŒŒì¼ì´ ìžˆìœ¼ë©´ ìŠ¤í…Œì´ì§•
git diff --name-only | grep -E '\.(ya?ml)$' | xargs -r git add 2>/dev/null || true

exit 0
